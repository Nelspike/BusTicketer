package bus.ticketer.connection;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.AbstractMap;
import java.util.List;
import java.util.Map;

import org.apache.http.client.methods.HttpPost;
import org.json.JSONObject;

import android.util.SparseArray;

public class ConnectionHandler implements Runnable {

	private String link, result, method;
	private Pair<String, String> payload;
	private int readTimeout = 10000, connectionTimeout = 15000;
	
	public ConnectionHandler(String link, String method, AbstractMap.SimpleEntry<String, String> payload) {
		this.link = link;
		this.method = method;
		this.payload = payload;
	}
	
	@Override
	public void run() {
	
	}
	
	public void connect() {
		HttpURLConnection con = null;
		String line = "";
		StringBuffer sb = new StringBuffer();
        try {
            
            URL url = new URL(link);
            con = (HttpURLConnection) url.openConnection();
            con.setReadTimeout(readTimeout);      /* milliseconds */
            con.setConnectTimeout(connectionTimeout);   /* milliseconds */
            con.setRequestMethod(method);
            con.setDoInput(true);

            if(payload != null) {
            	AbstractMap.SimpleEntry<String, String> params = new AbstractMap.SimpleEntry<String, String>(line, line);
            	params.add(new BasicNameValuePair("firstParam", paramValue1));
            	params.add(new BasicNameValuePair("secondParam", paramValue2));
            	params.add(new BasicNameValuePair("thirdParam", paramValue3));

            	OutputStream os = conn.getOutputStream();
            	BufferedWriter writer = new BufferedWriter(
            	        new OutputStreamWriter(os, "UTF-8"));
            	writer.write(getQuery(params));
            	writer.flush()
            	writer.close();
            	os.close();
            }
            
            // Start the connection
            con.connect();

            // Read results from the query
            BufferedReader reader = new BufferedReader(new InputStreamReader(con.getInputStream(), "UTF-8" ));
            
            while ((line = reader.readLine()) != null)
				sb.append(line);
            
            result = sb.toString();
            
            reader.close();
            } 
        catch (IOException e) {
        	//Handle Error
          } 
        finally {
            if (con != null)
              con.disconnect();
         }
	}

}
